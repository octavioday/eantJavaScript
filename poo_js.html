<!DOCTYPE html>
<html lang="es-AR">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
		<title>MercadoTECH - Tu e-shop.js</title>
		<link rel="stylesheet" href="https://blackrockdigital.github.io/startbootstrap-shop-item/vendor/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://blackrockdigital.github.io/startbootstrap-shop-item/css/shop-item.css">
	</head>
​
	<body>
		<header class="navbar navbar-expand-lg navbar-dark bg-secondary fixed-top">
			<div class="container">
				<a class="navbar-brand font-weight-bold" href="#">&#x1F5A5; MercadoTECH</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu" aria-controls="menu" aria-expanded="false" aria-label="Menu">
					<span class="navbar-toggler-icon"></span>
				</button>
				<nav class="collapse navbar-collapse" id="menu">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item active">
							<a class="nav-link" href="#">&#x1F512; Ingresar</a>
						</li>
					</ul>
				</nav>
			</div>
		</header>
		<main class="container">
			<h2 class="w-100 my-3 p-3 border">&#x2B50; Productos Destacados</h2>
​
			<!-- AREA PRODUCTOS DESTACADOS -->
			<section id="productos-destacados" class="row">
				<!-- Inicio Producto #1 -->
				<article class="col-lg-4 col-md-6 mb-4 d-none producto">
					<div class="card h-100">
						<a href="#">
							<img class="card-img-top" src="http://placehold.it/700x400" alt="">
		  				</a>
						<div class="card-body">
							<h4 class="card-title">
			  					<a href="#">Producto X</a>
							</h4>
							<h5 class="btn btn-warning">$999.99</h5>
							<p class="card-text">No deje pasar esta oportunidad... COMPRE YA!</p>
						</div>
					</div>
				</article>
				<!-- Fin de Producto #1 -->
​
			</section>
		</main>
		<footer class="py-5 bg-dark">
			<div class="container">
				<p class="m-0 text-center text-white">¡La mejor manera de comprar online!</p>
			</div>
		</footer>
		<script src="https://blackrockdigital.github.io/startbootstrap-shop-item/vendor/jquery/jquery.min.js"></script>
		<script src="https://blackrockdigital.github.io/startbootstrap-shop-item/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="producto.class.js"></script>
		<script>
			/* Persistencia en JavaScript con la API Storage */
			// window.localStorage (la info permanente hasta que se borra) && window.sessionStorage (si cierro la pestaña, se borra) //

			//window.localStorage.setItem("PRODUCTOS", "Dato que guardo") // nuevo almacenamiento. Nombre que lo va a identificar / Qué voy a guardar
			//window.localStorage.setItem("USUARIOS", "Dato que guardo 2") 
			//alert ( window.localStorage.getItem("PRODUCTOS") ) // consulta
			//window.localStorage.removeItem("USUARIOS") // elimina
			//window.localStorage.clear() // limpia todo

			// Creando una función asincrónica con JavaScript utilizando promise (crea un objeto difereido)
			/*const promesa = new Promise(function(ok, error){

				window.setTimeout(function(){

					let numerito = Math.random()

					if( numerito < 0.5 ) {
						ok(`${numerito} vale menos que 0.5`)
					} else {
						error(`${numerito} vale más que 0.5`)
					}
				}, 5000) 
						
			})

			promesa.then(function(rta){ // Esto ocurre cuando sale bien
				alert(`${rta} (mensaje desde el método then)`)
			}) 

			promesa.catch(function(rta){// Esto ocurre cuando sale mal

				alert(`${rta} (mensaje desde el método catch)`)
			}) 

			promesa.finally(function(){
				confirm("se entendio?")
			})
			*/


			//////////////////////////////////////////////
			const promesa = new Promise(function(ok, error){

				if( !window.localStorage.getItem("PRODUCTOS") ){ // Sino no existe el localStorage, traer los datos de la API
					
					const ajax = new XMLHttpRequest()
					ajax.open("GET", "https://api.myjson.com/bins/dcg2p")
					ajax.onload = function(){ //peticion exitosa

						if( this.status == 200 ){

							// Guardar datos de la petición

							window.localStorage.setItem("PRODUCTOS", this.response)

							ok(this.response) // Ejecutamos el metodo then
						}else {
							this.onerror()
						}
					}
					ajax.onerror = function(){ // Peticion erronea

						error( this.statusText)
					
					} 	
					ajax.send()	// ejecutar peticion asincronica (esperar a que responda la respuesta del server)		
				} else{ // Si existe el localStorage lo usamos para crear/mostrar los objetos producto
					ok( window.localStorage.getItem("PRODUCTOS") ) // Ejecuto el metodo then
				}				
			})

			promesa.then(function(rta){ // ocurre cuando hay datos en el storege

				let productos = Producto.parse(rta)

				productos.forEach(producto => {
					
					producto.Mostrar()
				})
			})

			promesa.catch(function(rta){

				document.querySelector("#productos-destacados").innerText = "Error amigo"

			})

			promesa.finally(function(){
				confirm("Se entendio?")
			})
		</script>
	</body>
</html>